# 관리자 상담 코너 기능명세서

## 1. 개요
- **기능명:** 관리자 상담 코너
- **목적:** 고객과 관리자 간의 상담 내역을 기록하고 관리하는 기능
- **대상 사용자:** 관리자(상담 내역 작성 및 관리), 고객(상담 내역 조회)
- **기술 스택:** Next.js, Tailwind CSS, Supabase(데이터베이스 및 스토리지)
- **관련 페이지:** 
  - 고객용: `/dashboard/consultation`
  - 관리자용: `/admin/consultation`

## 2. 기능 요구사항

### 2.1 고객용 상담 내역 조회 페이지
- **파일 위치:** `app/dashboard/consultation/page.tsx`
- **기능:**
  - 본인의 상담 내역 목록 조회
  - 상담 내역 상세 보기
  - 첨부 파일 다운로드
  - 하이퍼링크 접근
- **UI 구성요소:**
  - 상담 내역 목록 테이블 (날짜, 제목, 상태 표시)
  - 상세 내용 모달 또는 확장 패널
  - 첨부 파일 다운로드 버튼
  - 페이지네이션

### 2.2 관리자용 상담 내역 관리 페이지
- **파일 위치:** `app/admin/consultation/page.tsx`
- **기능:**
  - 모든 고객의 상담 내역 조회 및 필터링
  - 새로운 상담 내역 작성
  - 기존 상담 내역 수정 및 삭제
  - 첨부 파일 업로드 및 관리
  - 하이퍼링크 삽입
- **UI 구성요소:**
  - 상담 내역 목록 테이블 (날짜, 고객명, 제목, 상태 표시)
  - 검색 및 필터링 기능 (고객명, 날짜 범위)
  - 상담 내역 작성/수정 폼
  - 리치 텍스트 에디터 (하이퍼링크 삽입 기능 포함)
  - 파일 업로드 드래그 앤 드롭 영역
  - 페이지네이션

## 3. 데이터 모델

### 3.1 상담 내역 데이터
- **테이블명:** `consultations`
- **주요 필드:**
  - `id`: 상담 내역 고유 ID (UUID)
  - `user_id`: 고객 ID (외래 키)
  - `title`: 상담 제목
  - `content`: 상담 내용 (리치 텍스트 형식, 하이퍼링크 포함)
  - `consultation_date`: 상담 일자
  - `created_at`: 생성 일시
  - `updated_at`: 수정 일시
  - `status`: 상담 상태 (예: 진행중, 완료)
- **API 엔드포인트:** `/api/consultations`

### 3.2 첨부 파일 데이터
- **테이블명:** `consultation_attachments`
- **주요 필드:**
  - `id`: 첨부 파일 고유 ID (UUID)
  - `consultation_id`: 상담 내역 ID (외래 키)
  - `file_name`: 파일 원본 이름
  - `file_size`: 파일 크기
  - `file_type`: 파일 MIME 타입
  - `file_url`: Supabase Storage 파일 경로
  - `uploaded_at`: 업로드 일시
- **API 엔드포인트:** `/api/consultation-attachments`
- **스토리지 경로:** `consultations/{consultation_id}/{file_id}`

## 4. 컴포넌트 구조

### 4.1 공통 컴포넌트
- **리치 텍스트 에디터 컴포넌트**
  - **파일 위치:** `components/rich-text-editor.tsx`
  - **기능:**
    - 텍스트 서식 지정 (굵게, 기울임, 목록 등)
    - 하이퍼링크 삽입 및 편집
    - 이미지 삽입
  - **사용 라이브러리:** TipTap 또는 React Quill

- **파일 업로드 컴포넌트**
  - **파일 위치:** `components/file-uploader.tsx`
  - **기능:**
    - 드래그 앤 드롭 파일 업로드
    - 다중 파일 업로드 지원
    - 파일 크기 및 타입 검증
    - 업로드 진행 상태 표시
  - **사용 라이브러리:** react-dropzone

- **파일 뷰어 컴포넌트**
  - **파일 위치:** `components/file-viewer.tsx`
  - **기능:**
    - 첨부 파일 목록 표시
    - 파일 다운로드 기능
    - 이미지 파일 미리보기
  - **구현 방식:** Supabase Storage URL을 활용한 파일 접근

### 4.2 페이지별 컴포넌트
- **상담 내역 목록 컴포넌트**
  - **파일 위치:** `components/consultation-list.tsx`
  - **기능:**
    - 상담 내역 테이블 표시
    - 정렬 및 필터링
    - 페이지네이션

- **상담 내역 폼 컴포넌트**
  - **파일 위치:** `components/consultation-form.tsx`
  - **기능:**
    - 상담 내역 작성 및 수정 폼
    - 고객 선택 드롭다운
    - 날짜 선택 캘린더
    - 리치 텍스트 에디터 통합
    - 파일 업로드 컴포넌트 통합

- **상담 내역 상세 컴포넌트**
  - **파일 위치:** `components/consultation-detail.tsx`
  - **기능:**
    - 상담 내역 상세 정보 표시
    - 첨부 파일 목록 및 다운로드
    - 하이퍼링크 렌더링

## 5. API 엔드포인트

### 5.1 상담 내역 API
- **GET `/api/consultations`**
  - 모든 상담 내역 조회 (관리자용)
  - 쿼리 파라미터: `user_id`, `start_date`, `end_date`, `status`, `page`, `limit`

- **GET `/api/consultations/user/{user_id}`**
  - 특정 고객의 상담 내역 조회 (고객용)
  - 쿼리 파라미터: `page`, `limit`

- **GET `/api/consultations/{id}`**
  - 특정 상담 내역 상세 조회

- **POST `/api/consultations`**
  - 새로운 상담 내역 생성
  - 요청 본문: `user_id`, `title`, `content`, `consultation_date`, `status`

- **PUT `/api/consultations/{id}`**
  - 기존 상담 내역 수정
  - 요청 본문: `title`, `content`, `consultation_date`, `status`

- **DELETE `/api/consultations/{id}`**
  - 상담 내역 삭제

### 5.2 첨부 파일 API
- **GET `/api/consultation-attachments/{consultation_id}`**
  - 특정 상담 내역의 첨부 파일 목록 조회

- **POST `/api/consultation-attachments`**
  - 첨부 파일 업로드
  - 요청 본문: `consultation_id`, `file` (multipart/form-data)

- **DELETE `/api/consultation-attachments/{id}`**
  - 첨부 파일 삭제

## 6. Supabase 연동

### 6.1 데이터베이스 연동
- **테이블 생성:**
  - `consultations` 테이블 생성
  - `consultation_attachments` 테이블 생성
  - 외래 키 제약 조건 설정

- **RLS(Row Level Security) 설정:**
  - 관리자: 모든 상담 내역에 대한 CRUD 권한
  - 고객: 본인의 상담 내역에 대한 읽기 권한만 부여

### 6.2 스토리지 연동
- **버킷 생성:**
  - `consultations` 버킷 생성

- **스토리지 규칙 설정:**
  - 관리자: 모든 파일에 대한 읽기/쓰기 권한
  - 고객: 본인의 상담 내역 관련 파일에 대한 읽기 권한만 부여

- **파일 업로드 흐름:**
  1. 클라이언트에서 파일 선택
  2. API를 통해 Supabase Storage에 업로드
  3. 업로드 성공 시 파일 URL 반환
  4. 파일 메타데이터를 `consultation_attachments` 테이블에 저장

## 7. 사용자 인터페이스 (UI/UX)

### 7.1 고객용 상담 내역 페이지
- **디자인 가이드라인:**
  - 심플하고 직관적인 UI
  - 모바일 반응형 디자인
  - 상담 내역 목록은 카드 또는 테이블 형태로 표시
  - 상세 내용은 모달 또는 확장 패널로 표시

- **사용자 경험 고려사항:**
  - 첨부 파일 다운로드 시 진행 상태 표시
  - 하이퍼링크 클릭 시 새 탭에서 열기
  - 페이지 로딩 시 스켈레톤 UI 표시

### 7.2 관리자용 상담 내역 관리 페이지
- **디자인 가이드라인:**
  - 효율적인 관리를 위한 데이터 테이블 형태
  - 필터링 및 검색 기능 강조
  - 작성/수정 폼은 모달 또는 사이드 패널로 구현

- **사용자 경험 고려사항:**
  - 드래그 앤 드롭 파일 업로드 지원
  - 자동 저장 기능 (임시 저장)
  - 리치 텍스트 에디터의 직관적인 UI
  - 하이퍼링크 삽입 시 URL 검증

## 8. 테스트 계획

### 8.1 단위 테스트
- 각 API 엔드포인트 기능 테스트
- 컴포넌트 렌더링 테스트
- 폼 유효성 검사 테스트

### 8.2 통합 테스트
- 상담 내역 생성-조회-수정-삭제 흐름 테스트
- 파일 업로드 및 다운로드 테스트
- 하이퍼링크 삽입 및 렌더링 테스트

### 8.3 사용자 테스트
- 관리자 관점에서의 사용성 테스트
- 고객 관점에서의 사용성 테스트
- 다양한 디바이스 및 브라우저 호환성 테스트

## 9. 구현 일정

### 9.1 1단계: 기본 기능 구현 (1주)
- 데이터베이스 테이블 설계 및 생성
- API 엔드포인트 구현
- 기본 UI 컴포넌트 구현

### 9.2 2단계: 고급 기능 구현 (1주)
- 리치 텍스트 에디터 통합
- 파일 업로드/다운로드 기능 구현
- 하이퍼링크 기능 구현

### 9.3 3단계: 테스트 및 최적화 (1주)
- 단위 테스트 및 통합 테스트
- 성능 최적화
- 사용자 피드백 반영

## 10. 확장 가능성

### 10.1 향후 개선 사항
- 실시간 채팅 기능 추가
- 알림 시스템 연동 (새 상담 내역 알림)
- 상담 내역 템플릿 기능
- 통계 및 리포트 기능

---

이 문서는 투자 관리 대시보드의 관리자 상담 코너 기능에 대한 명세서입니다. 프로젝트 진행 상황에 따라 지속적으로 업데이트될 예정입니다. 