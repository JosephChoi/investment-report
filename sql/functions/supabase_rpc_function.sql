CREATE OR REPLACE FUNCTION search_users(search_query TEXT, page_limit INT, page_offset INT) RETURNS SETOF users AS $$ BEGIN IF search_query = '' THEN RETURN QUERY SELECT * FROM users ORDER BY created_at DESC LIMIT page_limit OFFSET page_offset; ELSE RETURN QUERY SELECT * FROM users WHERE name ILIKE '%' || search_query || '%' OR email ILIKE '%' || search_query || '%' OR account_number ILIKE '%' || search_query || '%' ORDER BY created_at DESC LIMIT page_limit OFFSET page_offset; END IF; END; $$ LANGUAGE plpgsql;
