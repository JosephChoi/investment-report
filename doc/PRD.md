# 투자 관리 페이지 PRD

## 1. 제품 개요
**제품명:** 투자 관리 대시보드  
**개발 배경:**  
고객이 자신의 투자 계좌 현황을 한눈에 확인하고, 포트폴리오 리포트 및 잔고 변화를 직관적으로 볼 수 있도록 하는 관리 페이지가 필요합니다. 또한, 관리자(admin)가 매달 중요한 투자 코멘트를 일괄 등록하여 고객들에게 제공할 수 있도록 기능을 구성합니다.

**주요 목표:**
- 고객이 가입한 포트폴리오에 맞는 월별 투자 리포트를 제공
- 매달 고객의 잔고 변화를 시각적으로 보여주는 그래프 기능
- 관리자가 공통적인 투자 코멘트를 등록하여 고객들에게 전달
- 고객 상담 내역 및 알림 관리 기능 제공

## 2. 대상 사용자
### **1) 고객 (일반 사용자)**
- 가입한 계좌의 잔고 현황 및 변화를 확인하고 싶은 사용자
- 자신의 포트폴리오에 맞는 최신 투자 리포트를 보고 싶은 사용자
- 전문가의 투자 코멘트를 확인하고 싶은 사용자
- 연체정보 및 리밸런싱 히스토리를 확인하고 싶은 사용자
- 관리자와의 상담 내역을 확인하고 싶은 사용자

### **2) 관리자 (Admin)**
- 매달 전체 고객에게 공통으로 제공될 투자 코멘트를 등록하는 사용자
- 매월 포트폴리오 리포트(jpg 파일)를 업로드하는 사용자
- 고객의 잔고 변화를 추적하고 데이터를 업데이트하는 사용자
- 고객 상담 내역을 관리하고 응답하는 사용자
- 시스템 알림을 관리하는 사용자

## 3. 사용자 흐름 (User Flow)

### **1) 관리자(Admin) 흐름**
1. 관리자 페이지 로그인
2. 관리자 대시보드에서 관리할 항목 선택
3. Monthly Comment 작성 및 등록
4. 포트폴리오 리포트(jpg) 업로드
5. 고객 데이터(엑셀 또는 CSV) 업로드
6. 고객별 포트폴리오 매칭 및 리포트 자동 노출
7. 고객 잔고 변화 데이터 업데이트 및 자동 누적 반영
8. 고객 상담 내역 관리 및 응답
9. 시스템 알림 등록 및 관리

### **2) 고객(User) 흐름**
1. 이메일 로그인
2. 대시보드에서 원하는 기능 선택
3. 월간리포트 페이지에서 계좌 정보 및 포트폴리오 확인
4. 최신 투자 코멘트 확인
5. 본인의 포트폴리오 리포트(JPG) 확인
6. 잔고 변화 그래프 확인
7. 연체정보 및 리밸런싱 히스토리 확인
8. 관리자 상담 내역 확인

## 4. 기능 요구사항

### **1) Monthly Comment (월간 코멘트 기능)**
- **기능 설명**: 관리자가 작성한 코멘트를 고객 페이지에서 공통적으로 표시
- **세부 사항**:
  - 관리자 페이지에서 매달 새로운 코멘트 작성 가능
  - 텍스트 에디터 사용 가능 (기본적인 서식 지원)
  - 고객 페이지에서는 최신 코멘트 1개만 노출
  - 월 선택 기능을 통해 과거 코멘트 관리 가능
- **개발 난이도**: 쉬움
- **우선순위**: 상
- **구현 상태**: 완료

### **2) 포트폴리오 리포트 (JPG 업로드 및 매칭)**
- **기능 설명**: 관리자가 업로드한 리포트를 고객의 포트폴리오에 맞게 자동 매칭하여 노출
- **세부 사항**:
  - 관리자 페이지에서 10개 내외의 포트폴리오 리포트(JPG) 업로드 가능
  - 드래그 앤 드롭 방식의 파일 업로드 UI 제공
  - 고객의 투자 데이터에서 해당 포트폴리오를 보유한 고객을 자동 매칭하여 리포트 노출
  - 고객 페이지에서는 본인에게 맞는 리포트만 확인 가능
  - 모달 창을 통한 전체 화면 보기 기능 제공
  - 파일명 자동 정규화 및 특수문자 제거 기능
  - 파일 업로드 시 중복 파일 처리 및 덮어쓰기 기능
  - 파일 업로드 실패 시 자동 재시도 메커니즘 (최대 3회)
  - 파일 형식 및 크기 검증 (JPG, PNG, GIF 형식만 허용, 최대 10MB)
- **개발 난이도**: 보통
- **우선순위**: 상
- **구현 상태**: 완료

### **3) 잔고 변화 그래프**
- **기능 설명**: 고객의 잔고 변화를 그래프로 시각화하여 제공
- **세부 사항**:
  - 관리자가 매달 엑셀/CSV 데이터를 업로드하면 자동으로 누적
  - 데이터베이스는 Supabase 사용
  - 업로드된 데이터에서 고객명, 계좌번호, 대표MP, 전일잔고 데이터를 기준으로 잔고 변화를 저장
  - 그래프의 X축은 파일명에 표기된 일자를 기준으로 생성
  - 그래프는 애니메이션 효과 포함 (Recharts 사용)
  - 고객 페이지 로그인 시 본인 잔고 변화 그래프만 확인 가능
  - 커스텀 툴팁으로 상세 정보 표시
- **개발 난이도**: 어려움
- **우선순위**: 상
- **구현 상태**: 완료

### **4) 관리자 상담 내역 관리**
- **기능 설명**: 고객 상담 내역을 등록하고 관리하는 기능
- **세부 사항**:
  - 테이블 형태의 상담 내역 목록 제공
  - 검색 및 필터링 기능
  - 상담 내역 추가/수정/삭제 기능
  - 폼 기반의 상담 내역 입력 UI
  - 고객별 상담 내역 관리
- **개발 난이도**: 보통
- **우선순위**: 중
- **구현 상태**: 완료

### **5) 최근 알림 관리**
- **기능 설명**: 고객에게 표시될 알림을 관리하는 기능
- **세부 사항**:
  - 알림 목록 테이블 제공
  - 활성/비활성 상태 토글 기능
  - 알림 추가/수정/삭제 기능
  - 날짜 기반 정렬 기능
  - 고객 대시보드에 최신 알림 표시
- **개발 난이도**: 쉬움
- **우선순위**: 중
- **구현 상태**: 완료

### **6) 연체정보 확인**
- **기능 설명**: 고객의 연체 정보를 관리하고 표시하는 기능
- **세부 사항**:
  - 관리자가 연체정보 엑셀 업로드
  - 고객별 연체 내역 및 상환 일정 표시
  - 연체 상태 관리
- **개발 난이도**: 보통
- **우선순위**: 중
- **구현 상태**: 계획됨

### **7) 리밸런싱 히스토리**
- **기능 설명**: 포트폴리오 리밸런싱 내역을 관리하고 표시하는 기능
- **세부 사항**:
  - 관리자가 월별 리밸런싱 내용 엑셀 업로드
  - 고객별 리밸런싱 히스토리 표시
  - 리밸런싱 상세 내역 제공
- **개발 난이도**: 보통
- **우선순위**: 중
- **구현 상태**: 계획됨

## 5. 기술 스택 및 개발 환경
- **프론트엔드**: Next.js, React, Tailwind CSS
- **상태 관리**: React Hooks (useState, useEffect)
- **UI 컴포넌트**: 자체 구현 컴포넌트
- **백엔드 및 데이터베이스**: Supabase
- **파일 업로드 및 처리**: Supabase Storage
  - 단일 경로 구조 사용 (`year/month/filename`)
  - 파일명 정규화 및 특수문자 제거
  - 업로드 재시도 메커니즘
  - 캐시 방지를 위한 타임스탬프 추가
- **그래프 라이브러리**: Recharts
- **아이콘 라이브러리**: Lucide React
- **데이터 업로드 지원 형식**: Excel(.xlsx) 및 CSV(.csv)
- **버전 관리**: Git, GitHub
- **배포**: Vercel (예정)

## 6. 예상 개발 로드맵
| 주차  | 작업 항목 | 상태 |
|------|--------------------------------|------|
| 1주차 | 프로젝트 설정 및 기본 UI 구축 | 완료 |
| 2주차 | 관리자 페이지: Monthly Comment 작성 기능 구현 | 완료 |
| 3주차 | 관리자 페이지: 포트폴리오 리포트 업로드 및 매칭 기능 구현 | 완료 |
| 4주차 | 데이터베이스 연동 및 Supabase 설정 | 완료 |
| 5주차 | 고객 페이지: 로그인 및 계좌 정보 확인 기능 개발 | 완료 |
| 6주차 | 고객 페이지: 잔고 변화 그래프 구현 | 완료 |
| 7주차 | 관리자 페이지: 상담 내역 및 알림 관리 기능 구현 | 완료 |
| 8주차 | 파일 업로드 및 스토리지 관리 개선 | 완료 |
| 9주차 | 연체정보 및 리밸런싱 히스토리 기능 구현 | 계획됨 |
| 10주차 | 전체 기능 테스트 및 버그 수정 | 계획됨 |
| 11주차 | 배포 및 유지보수 계획 수립 | 계획됨 |

## 7. 프로젝트 구조도

### **디렉토리 구조**
```
investment-report/
├── app/                      # Next.js App Router 디렉토리
│   ├── dashboard/            # 고객 대시보드 페이지
│   │   ├── page.tsx          # 대시보드 메인 페이지
│   │   └── monthly-report/   # 월간리포트 페이지
│   ├── admin/                # 관리자 페이지
│   │   ├── page.tsx          # 관리자 대시보드
│   │   ├── monthly-report/   # 월간 코멘트 관리
│   │   ├── consultation/     # 상담 내역 관리
│   │   ├── notifications/    # 알림 관리
│   │   ├── delinquency/      # 연체정보 관리 (예정)
│   │   └── rebalancing/      # 리밸런싱 관리 (예정)
│   ├── api/                  # API 라우트 디렉토리
│   │   ├── admin/            # 관리자 API
│   │   │   ├── monthly-comment/  # 월간 코멘트 API
│   │   │   ├── monthly-report/   # 월간 리포트 API
│   │   │   ├── portfolio-file/   # 포트폴리오 파일 API
│   │   │   │   └── upload/       # 파일 업로드 API
│   │   │   ├── portfolio-types/  # 포트폴리오 타입 API
│   │   │   └── customer-data/    # 고객 데이터 API
│   │   ├── auth/             # 인증 관련 API
│   │   ├── user/             # 사용자 정보 API
│   │   ├── get-balance/      # 잔고 조회 API
│   │   └── latest-monthly-report/ # 최신 월간 리포트 API
│   ├── login/                # 로그인 페이지
│   ├── signup/               # 회원가입 페이지
│   ├── reset-password/       # 비밀번호 재설정 페이지
│   ├── layout.tsx            # 전체 레이아웃
│   ├── page.tsx              # 메인 페이지 (로그인으로 리다이렉트)
│   └── globals.css           # 전역 스타일
├── components/               # 재사용 가능한 컴포넌트
│   ├── ui/                   # UI 컴포넌트
│   │   ├── card.tsx          # 카드 컴포넌트
│   │   ├── chart.tsx         # 차트 컴포넌트
│   │   └── balance-chart.tsx # 잔고 변화 그래프 컴포넌트
│   ├── chart-wrapper.tsx     # 차트 래퍼 컴포넌트
│   ├── portfolio-report.tsx  # 포트폴리오 리포트 컴포넌트
│   └── portfolio-report-wrapper.tsx # 포트폴리오 리포트 래퍼 컴포넌트
├── lib/                      # 유틸리티 및 공통 함수
│   └── utils.ts              # 유틸리티 함수
├── db/                       # 데이터베이스 관련 파일
├── supabase/                 # Supabase 설정 파일
├── public/                   # 정적 파일
├── test-storage.js           # 스토리지 테스트 스크립트
└── doc/                      # 문서 파일
    ├── PRD.md                # 제품 요구사항 문서
    ├── Design guide.md       # 디자인 가이드
    ├── Database guide.md     # 데이터베이스 가이드
    └── Frontend guide.md     # 프론트엔드 가이드
```

### **주요 컴포넌트 구조**

#### **1. 대시보드 페이지 (Dashboard)**
- **파일 위치**: `app/dashboard/page.tsx`
- **주요 기능**:
  - 메뉴 카드 형태의 네비게이션 제공
  - 월간리포트, 연체정보, 리밸런싱 히스토리, 관리자 상담 내역 메뉴
  - 최근 알림 섹션 표시
  - 각 기능별 링크 제공

#### **2. 월간리포트 페이지**
- **파일 위치**: `app/dashboard/monthly-report/page.tsx`
- **주요 기능**:
  - 계좌 정보 표시 (계좌번호, 대표 MP, 전월/현재 잔고)
  - 월간 투자 코멘트 표시
  - 잔고 변화 그래프 표시
  - 포트폴리오 리포트 표시

#### **3. 관리자 대시보드**
- **파일 위치**: `app/admin/page.tsx`
- **주요 기능**:
  - 관리 항목별 카드 형태의 네비게이션 제공
  - 각 관리 기능으로의 링크 제공
  - 관리 항목별 간략한 설명 제공

#### **4. 차트 컴포넌트 (BalanceChart)**
- **파일 위치**: `components/ui/chart.tsx`
- **주요 기능**:
  - Recharts를 사용한 잔고 변화 시각화
  - 애니메이션 효과 적용
  - 커스텀 툴팁으로 상세 정보 표시
  - 반응형 디자인 지원

#### **5. 포트폴리오 리포트 컴포넌트**
- **파일 위치**: `components/portfolio-report.tsx`
- **주요 기능**:
  - 포트폴리오 리포트 이미지 표시
  - 전체 화면 모달 기능
  - 이미지 확대/축소 기능 (예정)

### **데이터 흐름**

#### **1. 고객 데이터 흐름**
```
Supabase DB → API Routes → 대시보드 페이지 → UI 컴포넌트
```

#### **2. 포트폴리오 리포트 흐름**
```
관리자 업로드 → Supabase Storage → API Routes → 포트폴리오 리포트 컴포넌트
```

#### **3. 월간 코멘트 흐름**
```
관리자 작성 → Supabase DB → API Routes → 대시보드 페이지
```

#### **4. 상담 내역 흐름**
```
관리자 등록/수정 → Supabase DB → API Routes → 고객 페이지
```

#### **5. 알림 흐름**
```
관리자 등록/수정 → Supabase DB → API Routes → 고객 대시보드
```

### **향후 개발 계획**
- 연체정보 및 리밸런싱 히스토리 기능 구현
- Supabase 인증 시스템 구현
- 실시간 데이터 업데이트 기능
- 모바일 최적화 및 반응형 디자인 개선
- 다국어 지원 (i18n)
- 사용자 활동 로깅 및 분석 기능
- 성능 최적화 및 코드 리팩토링
- 자동화된 테스트 구현
- CI/CD 파이프라인 구축
- 파일 업로드 및 스토리지 관리 추가 개선
  - 대용량 파일 처리 최적화
  - 파일 업로드 진행 상태 표시
  - 파일 미리보기 기능

---

이 문서는 투자 관리 대시보드 프로젝트의 요구사항과 개발 계획을 정의합니다. 프로젝트 진행 상황에 따라 지속적으로 업데이트될 예정입니다.

