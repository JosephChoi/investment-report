# 연체정보 기능명세서

## 1. 개요
- **기능명:** 연체정보 관리 시스템
- **목적:** 관리자가 연체가 있는 계좌 정보만 포함된 엑셀 자료를 업로드하여 고객별 연체정보를 관리하고, 고객에게 연체 상태 및 미납금액 정보를 제공하는 기능
- **대상 사용자:** 관리자(연체정보 업로드 및 관리), 고객(연체정보 조회)
- **기술 스택:** Next.js, Tailwind CSS, Supabase(데이터베이스)
- **관련 페이지:** 
  - 고객용: `/dashboard` (대시보드 내 연체정보 섹션)
  - 관리자용: `/admin/overdue-payments`

## 2. 기능 요구사항

### 2.1 고객용 연체정보 조회 기능
- **파일 위치:** `app/dashboard/page.tsx` (대시보드 내 연체정보 섹션)
- **기능:**
  - 본인 계좌의 연체정보 조회
  - 연체 상태에 따른 시각적 구분 (3개월 이상 연체 강조 표시)
  - 연체가 없는 경우 "연체 없음" 안내 표시
- **UI 구성요소:**
  - 연체정보 카드 (계좌번호, 출금계좌번호, 대표MP명, 미납금액, 연체상태 표시)
  - 연체 상태별 색상 구분
  - 3개월 이상 연체 시 특별 표시
  - 연체 없음 안내 메시지

### 2.2 관리자용 연체정보 관리 페이지
- **파일 위치:** `app/admin/overdue-payments/page.tsx`
- **기능:**
  - 엑셀 파일 업로드를 통한 연체정보 일괄 갱신
  - 업로드된 연체정보 조회 및 필터링
  - 연체정보 관련 안내사항 작성 (Quill 에디터 사용)
  - 업로드 이력 관리
- **UI 구성요소:**
  - 엑셀 파일 업로드 영역
  - 업로드된 연체정보 목록 테이블
  - 검색 및 필터링 기능 (고객명, 계좌번호, 연체상태 등)
  - 안내사항 작성 폼 (Quill 에디터)
  - 업로드 이력 목록

## 3. 데이터 모델

### 3.1 연체정보 데이터
- **테이블명:** `overdue_payments`
- **주요 필드:**
  - `id`: 연체정보 고유 ID (UUID)
  - `account_name`: 계좌명 (고객 이름)
  - `contract_date`: 계약일
  - `mp_name`: 대표MP명 (상품 이름)
  - `account_number`: 계좌번호
  - `withdrawal_account`: 수수료출금계좌
  - `previous_day_balance`: 전일잔고
  - `advisory_fee_total`: 자문수수료계
  - `paid_amount`: 납입액
  - `unpaid_amount`: 미납금액
  - `manager`: 유치자 (담당자 이름)
  - `contact_number`: 연락처
  - `overdue_status`: 연체상태 (예: "3달", "연체중", "정상" 등)
  - `updated_at`: 갱신 일시
  - `batch_id`: 업로드 배치 ID (같은 엑셀 파일에서 업로드된 데이터 그룹화)
- **API 엔드포인트:** `/api/overdue-payments`

### 3.2 연체정보 안내사항 데이터
- **테이블명:** `overdue_payment_notices`
- **주요 필드:**
  - `id`: 안내사항 고유 ID (UUID)
  - `content`: 안내사항 내용 (Quill 에디터 형식)
  - `created_at`: 생성 일시
  - `updated_at`: 수정 일시
  - `created_by`: 작성자 ID (관리자)
- **API 엔드포인트:** `/api/overdue-payment-notices`

## 4. 컴포넌트 구조

### 4.1 공통 컴포넌트
- **Quill 에디터 컴포넌트** (공지사항과 공유)
  - **파일 위치:** `components/quill-editor.tsx`
  - **기능:**
    - 텍스트 서식 지정 (굵게, 기울임, 목록 등)
    - 하이퍼링크 삽입 및 편집
  - **사용 라이브러리:** React Quill

- **엑셀 파일 업로드 컴포넌트**
  - **파일 위치:** `components/excel-uploader.tsx`
  - **기능:**
    - 드래그 앤 드롭 엑셀 파일 업로드
    - 파일 유효성 검증 (확장자, 크기 등)
    - 업로드 진행 상태 표시
  - **사용 라이브러리:** react-dropzone, xlsx

### 4.2 페이지별 컴포넌트
- **연체정보 카드 컴포넌트**
  - **파일 위치:** `components/overdue-payment-card.tsx`
  - **기능:**
    - 연체정보 카드 형태로 표시
    - 연체 상태에 따른 시각적 구분
    - 3개월 이상 연체 강조 표시

- **연체정보 목록 컴포넌트**
  - **파일 위치:** `components/overdue-payment-list.tsx`
  - **기능:**
    - 연체정보 목록 테이블 형태로 표시
    - 정렬 및 필터링
    - 페이지네이션

- **연체정보 안내사항 컴포넌트**
  - **파일 위치:** `components/overdue-payment-notice.tsx`
  - **기능:**
    - 연체정보 관련 안내사항 표시
    - Quill 에디터 형식 지원

- **대시보드 연체정보 섹션 컴포넌트**
  - **파일 위치:** `components/dashboard-overdue-payments.tsx`
  - **기능:**
    - 대시보드에 표시될 연체정보 카드
    - 연체 상태별 시각적 구분
    - 연체 없음 안내 메시지

## 5. API 엔드포인트

### 5.1 연체정보 API
- **GET `/api/overdue-payments`**
  - 모든 연체정보 조회 (관리자용)
  - 쿼리 파라미터: `account_name`, `account_number`, `overdue_status`, `page`, `limit`

- **GET `/api/overdue-payments/user`**
  - 현재 로그인한 사용자에게 해당하는 연체정보 조회 (고객용)
  - 사용자의 계좌정보를 기반으로 필터링

- **POST `/api/overdue-payments/upload`**
  - 엑셀 파일 업로드를 통한 연체정보 일괄 갱신
  - 요청 본문: `file` (multipart/form-data)
  - 기존 데이터 삭제 후 새 데이터 저장

### 5.2 연체정보 안내사항 API
- **GET `/api/overdue-payment-notices/latest`**
  - 최신 연체정보 안내사항 조회

- **POST `/api/overdue-payment-notices`**
  - 새로운 연체정보 안내사항 생성
  - 요청 본문: `content`

- **PUT `/api/overdue-payment-notices/{id}`**
  - 기존 연체정보 안내사항 수정
  - 요청 본문: `content`

## 6. Supabase 연동

### 6.1 데이터베이스 연동
- **테이블 생성:**
  - `overdue_payments` 테이블 생성
  - `overdue_payment_notices` 테이블 생성
  - 외래 키 제약 조건 설정

- **RLS(Row Level Security) 설정:**
  - 관리자: 모든 연체정보에 대한 CRUD 권한
  - 고객: 본인에게 해당하는 연체정보에 대한 읽기 권한만 부여

## 7. 사용자 인터페이스 (UI/UX)

### 7.1 고객용 연체정보 섹션 (대시보드)
- **디자인 가이드라인:**
  - 연체 상태에 따른 색상 구분 (연체: 붉은색, 정상: 녹색)
  - 3개월 이상 연체 시 특별 강조 표시
  - 간결하고 직관적인 UI
  - 모바일 반응형 디자인

- **사용자 경험 고려사항:**
  - 연체정보는 시각적으로 명확하게 표시
  - 연체 없음 안내는 안심을 주는 디자인
  - 연체정보 안내사항은 별도 섹션으로 구분

### 7.2 관리자용 연체정보 관리 페이지
- **디자인 가이드라인:**
  - 효율적인 관리를 위한 데이터 테이블 형태
  - 연체 상태별 색상 구분
  - 필터링 및 검색 기능 강조
  - 엑셀 업로드 영역은 눈에 띄게 설계

- **사용자 경험 고려사항:**
  - 엑셀 파일 업로드 시 진행 상태 표시
  - 업로드 결과 요약 제공 (성공/실패 레코드 수 등)
  - Quill 에디터의 직관적인 UI
  - 업로드 이력 조회 기능

## 8. 테스트 계획

### 8.1 단위 테스트
- 각 API 엔드포인트 기능 테스트
- 엑셀 파일 파싱 및 데이터 처리 테스트
- 컴포넌트 렌더링 테스트

### 8.2 통합 테스트
- 엑셀 업로드-데이터 갱신-조회 흐름 테스트
- 고객별 연체정보 필터링 테스트
- 연체 상태별 표시 테스트

### 8.3 사용자 테스트
- 관리자 관점에서의 사용성 테스트
- 고객 관점에서의 사용성 테스트
- 다양한 디바이스 및 브라우저 호환성 테스트
- 다양한 형식의 엑셀 파일 업로드 테스트

## 9. 구현 일정

### 9.1 1단계: 기본 기능 구현 (1주)
- 데이터베이스 테이블 설계 및 생성
- API 엔드포인트 구현
- 기본 UI 컴포넌트 구현

### 9.2 2단계: 고급 기능 구현 (1주)
- 엑셀 파일 업로드 및 파싱 기능 구현
- 연체정보 필터링 기능 구현
- 연체 상태별 표시 기능 구현
- Quill 에디터 통합

### 9.3 3단계: 테스트 및 최적화 (1주)
- 단위 테스트 및 통합 테스트
- 성능 최적화
- 사용자 피드백 반영

## 10. 확장 가능성

### 10.1 향후 개선 사항
- 연체정보 변경 이력 추적 기능
- 연체정보 알림 시스템 (이메일, 푸시 알림)
- 연체정보 통계 및 리포트 기능
- 연체 해결을 위한 온라인 납부 기능 연동
- 과거 연체정보 아카이브 기능

---

이 문서는 투자 관리 대시보드의 연체정보 기능에 대한 명세서입니다. 프로젝트 진행 상황에 따라 지속적으로 업데이트될 예정입니다.